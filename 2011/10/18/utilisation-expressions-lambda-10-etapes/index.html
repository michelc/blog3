<!doctype html>
<html lang="fr-FR">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Utilisation d’expressions lambda en 10 étapes - blog.pagesd.info</title>
    <link rel="shortcut icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" href="/atom.xml" title="blog.pagesd.info" type="application/atom+xml">
    <meta name="author" content="Michel" />
<link rel="canonical" href="https://blog3.pagesd.info/2011/10/18/utilisation-expressions-lambda-10-etapes/" />
<meta property="og:title" content="Utilisation d’expressions lambda en 10 étapes" />
<meta property="og:locale" content="fr-FR" />
<meta property="og:url" content="https://blog3.pagesd.info/2011/10/18/utilisation-expressions-lambda-10-etapes/" />
<meta property="og:site_name" content="blog.pagesd.info" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-10-18T16:59:00.000Z" />
<script type="application/ld+json">{"headline":"blog.pagesd.info","dateModified":"2011-10-18T16:59:00.000Z","datePublished":"2011-10-18T16:59:00.000Z","inLanguage":"fr-FR","url":"https://blog3.pagesd.info/2011/10/18/utilisation-expressions-lambda-10-etapes/","@type":"BlogPosting","image":"","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog3.pagesd.info/2011/10/18/utilisation-expressions-lambda-10-etapes/"},"author":{"@type":"Person","name":"Michel"},"@context":"https://schema.org"}</script>
  </head>

  <body><div class="container">

    <header><nav>
      <a class="title" href="/">blog.pagesd.info</a>
      // <a href="/archives/">archives</a>
      // <a href="/traductions/">traductions</a>
    </nav></header>



<article>



  <header>
    <h1>
      <a href="/2011/10/18/utilisation-expressions-lambda-10-etapes/">Utilisation d’expressions lambda en 10 étapes</a>
    </h1>
    <p>
      <span>2011-10-18</span>
      <span>#csharp</span>
    </p>
  </header>

  <div>

<h2>Point de départ : 3 fonctions avec du code répétitif ( !DRY)</h2>
<h3>PrevisionFacturationSrv.cs</h3>
<pre><code>PrevSrv.UpdateEndOfContract(PrevFinContrat);
PrevSrv.UpdateEndOfMonth(PrevFinMois);
PrevSrv.UpdatePlacement(PrevPlacement, PonderationPlacement);
</code></pre>
<h3>PrevisionSrv.cs</h3>
<pre><code>/// &lt;summary&gt;
/// Màj de la prévision de facturation fin de contrat pour un ensemble de Siren / Société
/// &lt;/summary&gt;
/// &lt;param name=&quot;list&quot;&gt;Liste des couples Siren / Société et des montants à traiter&lt;/param&gt;
public void UpdateEndOfContract(IList&lt;PrevisionFacturation&gt; list)
{
  foreach (var pf in list)
  {
    var Prevision = this.GetBySirenAndSociety(pf.Siren, pf.Societe);

    Prevision.FinContrat = pf.Montant &lt; 0 ? 0 : Math.Round(pf.Montant, 2);

    this.CreateOrUpdate(Prevision);
  }
}

/// &lt;summary&gt;
/// Màj de la prévision de facturation fin de mois pour un ensemble de Siren / Société
/// &lt;/summary&gt;
/// &lt;param name=&quot;list&quot;&gt;Liste des couples Siren / Société et des montants à traiter&lt;/param&gt;
public void UpdateEndOfMonth(IList&lt;PrevisionFacturation&gt; list)
{
  foreach (var pf in list)
  {
    var Prevision = this.GetBySirenAndSociety(pf.Siren, pf.Societe);

    Prevision.FinMois = pf.Montant &lt; 0 ? 0 : Math.Round(pf.Montant, 2);
    Prevision.NbContrats = pf.Nombre;

    this.CreateOrUpdate(Prevision);
  }
}

/// &lt;summary&gt;
/// Màj de la prévision de facturation placement pour un ensemble de Siren / Société
/// &lt;/summary&gt;
/// &lt;param name=&quot;list&quot;&gt;Liste des couples Siren / Société et des montants à traiter&lt;/param&gt;
/// &lt;param name=&quot;ponderation&quot;&gt;Taux de pondération pour la prise en compte du placement&lt;/param&gt;
public void UpdatePlacement(IList&lt;PrevisionFacturation&gt; list, int ponderation)
{
  foreach (var pf in list)
  {
    var Prevision = this.GetBySirenAndSociety(pf.Siren, pf.Societe);

    Prevision.Placement = pf.Montant &lt; 0 ? 0 : Math.Round(pf.Montant * ponderation / 100, 2);

    this.CreateOrUpdate(Prevision);
  }
}
</code></pre>
<h2>Source d'inspiration (à lire !)</h2>
<p><a href="http://fguillot.developpez.com/cours/dotnet/introduction-delegates-csharp/">Introduction au délégués en C#</a>, un article en français rédigé
par Fabien Guillot pour expliquer aux débutants comment fonctionnent les
délégués en C#, quelle est leur utilité, et quelle a été leur évolution avec
les différentes versions du Framework .NET.</p>
<h2>Les 10 étapes</h2>
<ul>
<li>1° étape : Mise en commun du code (ancien style)</li>
<li>2° étape : Isolation des traitements spécifiques dans des fonctions
séparées</li>
<li>3° étape : Mise en place des délégués (enfin !)</li>
<li>4° étape : Simplification des délégués grâce à l'inférence de
type</li>
<li>5° étape : Arrivée des méthodes anonymes (avec .NET 2)</li>
<li>6° étape : Simplification des délégués anonymes grâce à l'inférence de
type</li>
<li>7° étape : Retour sur le code : <code>ref</code> ne sert à rien
(merci Nicolas)</li>
<li>8° étape : Arrivée des expressions lambdas (avec .NET 3.5)</li>
<li>9° étape : Simplification des expressions lambdas</li>
<li>10° étape : Utilisation de paramètres optionnels</li>
</ul>
<p>Consulter éventuellement la version PDF pour voir en détail comment se sont
déroulées ces étapes : <a href="/public/2011/Utilisation_Expressions_Lambda_en_10_etapes.pdf">Utilisation_Expressions_Lambda_en_10_etapes.pdf</a>.</p>
<h2>Le résultat</h2>
<h3>PrevisionFacturationSrv.cs</h3>
<pre><code>PrevSrv.UpdatePrevision(PrevFinContrat, (p, m, n) =&gt; { p.FinContrat = m; });
PrevSrv.UpdatePrevision(PrevFinMois, (p, m, n) =&gt; { p.FinMois = m; p.NbContrats = n; });
PrevSrv.UpdatePrevision(PrevPlacement, (p, m, n) =&gt; { p.Placement = m; }, PonderationPlacement);
</code></pre>
<h3>PrevisionSrv.cs</h3>
<pre><code>/// &lt;summary&gt;
/// Mise à jour de la prévision de facturation pour un ensemble de Siren / Société
/// &lt;/summary&gt;
/// &lt;param name=&quot;list&quot;&gt;Liste des couples Siren / Société et des montants à traiter&lt;/param&gt;
/// &lt;param name=&quot;assign&quot;&gt;Méthode pour réaliser le traitement spécifique&lt;/param&gt;
/// &lt;param name=&quot;ponderation&quot;&gt;Taux de pondération pour le type de prévision&lt;/param&gt;
public void UpdatePrevision(IList&lt;PrevisionFacturation&gt; list, UpdateAssign assign, int ponderation = 100)
{
  foreach (var pf in list)
  {
    pf.Montant = pf.Montant &lt; 0 ? 0 : Math.Round(pf.Montant * ponderation / 100, 2);

    var Prevision = this.GetBySirenAndSociety(pf.Siren, pf.Societe);

    assign(Prevision, pf.Montant, pf.Nombre);

    this.CreateOrUpdate(Prevision);
  }
}

/// &lt;summary&gt;
/// Signature des fonctions d'affectation spécifiques
/// &lt;/summary&gt;
/// &lt;param name=&quot;prevision&quot;&gt;Objet Prevision à mettre à jour&lt;/param&gt;
/// &lt;param name=&quot;montant&quot;&gt;Montant de la prévision&lt;/param&gt;
/// &lt;param name=&quot;nombre&quot;&gt;Nombre de contrats traités (ssi fin de mois)&lt;/param&gt;
public delegate void UpdateAssign(Prevision prevision, decimal montant, int nombre);
</code></pre>


  </div>

</article><nav class="paginate">
  <a rel="prev" href="/2011/10/17/personnalisation-css-aspnetmvc/" hreflang="fr-FR">Personnalisation de la CSS pour ASP.NET MVC</a>
  <a rel="next" href="/2011/11/17/mvc-scaffolding-eager-loading-viewmodel/" hreflang="fr-FR">MVC Scaffolding, Eager loading et ViewModel</a>
</nav>



    <footer>
      <a href="/">blog.pagesd.info</a> --
      <a href="https://www.solitaire-play.com/">www.solitaire-play.com</a>
    </footer>

  </div></body>

</html>

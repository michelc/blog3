<!doctype html>
<html lang="fr-FR">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Group By d&#39;un champ Mémo sous Access - blog.pagesd.info</title>
    <link rel="shortcut icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" href="/atom.xml" title="blog.pagesd.info" type="application/atom+xml">
    <meta name="author" content="Michel" />
<link rel="canonical" href="https://blog.pagesd.info/2008/12/17/group-by-champ-memo-access/" />
<meta property="og:title" content="Group By d&#39;un champ Mémo sous Access" />
<meta property="og:locale" content="fr-FR" />
<meta property="og:url" content="https://blog.pagesd.info/2008/12/17/group-by-champ-memo-access/" />
<meta property="og:site_name" content="blog.pagesd.info" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-12-17T11:56:00.000Z" />
<script type="application/ld+json">{"headline":"blog.pagesd.info","dateModified":"2008-12-17T11:56:00.000Z","datePublished":"2008-12-17T11:56:00.000Z","inLanguage":"fr-FR","url":"https://blog.pagesd.info/2008/12/17/group-by-champ-memo-access/","@type":"BlogPosting","image":"","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.pagesd.info/2008/12/17/group-by-champ-memo-access/"},"author":{"@type":"Person","name":"Michel"},"@context":"https://schema.org"}</script>
  </head>

  <body><div class="container">

    <header><nav>
      <a class="title" href="/">blog.pagesd.info</a>
      // <a href="/archives/">archives</a>
      // <a href="/traductions/">traductions</a>
    </nav></header>



<article>



  <header>
    <h1>
      <a href="/2008/12/17/group-by-champ-memo-access/">Group By d&#39;un champ Mémo sous Access</a>
    </h1>
    <p>
      <span>2008-12-17</span>
      <span>#ap</span><span>#sql</span>
    </p>
  </header>

  <div>

<p>Hier soir j'ai enfin corrigé un bug sournois qui raccourcissait les
descriptions des films à 255 caractères. Jusqu'à présent, je n'avais pas réussi
à reproduire ce bug en local et donc à trouver ce qui pouvait le provoquer.
Mais à force d'insister et d'éliminer tout ce qui ne pouvait pas poser
problème, j'ai fini par avoir de gros doutes sur la requête qui sert à mettre à
jour la date de dernière programmation des films.</p>
<p>Cette requête retrouve tous les films dont la date de dernière programmation
actuellement enregistrée (dir_Movies.lastDate) est inférieure à la date de la
dernière séance correspondant à ce film (dir_Seances.progDate).</p>
<pre><code>SELECT T1.idMovie, 
       T1.displayName, 
       T1.description, 
       T1.length, 
       T1.picture, 
       T1.lastDate, 
       MAX(T2.progDate) AS progDate 
FROM   dir_Movies  T1, 
       dir_Seances T2 
WHERE  (T2.keyFilm = T1.idMovie) 
GROUP BY 
       T1.idMovie, 
       T1.displayName, 
       T1.description, 
       T1.length, 
       T1.picture, 
       T1.lastDate 
HAVING (T1.lastDate &lt; MAX(T2.progDate))
</code></pre>
<p>Le souci, c'est qu'en local, cette requête ne renvoyait aucune ligne. Ce qui
est &quot;normal&quot; dans la mesure où ma base de données locale est une simple copie
de la base de données de production, et que lorsque je récupère cette copie, la
mise à jour de la date de dernière programmation a déjà été faite.</p>
<p>Par conséquent, il a d'abord fallu bidouiller la table des films pour que je
puisse tester en local cette requête. Pour cela, j'ai mis toutes les dates de
dernière programmation au 1° décembre.</p>
<pre><code>UPDATE dir_Movies SET dir_Movies.lastDate = #12/1/2008#;
</code></pre>
<p>Et là, la requête qui me semblait douteuse m'a renvoyé 52 lignes. Après
avoir agrandi la colonne &quot;description&quot;, j'ai pu constater qu'en effet celle-ci
était bel et bien coupée et à première vue à quelque chose comme 255
caractères.</p>
<p>Étant donné que je n'avais pas vraiment besoin de faire un GROUP BY sur la
description, j'ai donc modifié ma requête pour faire sortir la colonne
&quot;description&quot; de la clause GROUP BY :</p>
<pre><code>SELECT T1.idMovie, 
       T1.displayName, 
       T1.length, 
       T1.picture, 
       T1.lastDate, 
       MAX(T1.description) AS description, 
       MAX(T2.progDate) AS progDate 
FROM   dir_Movies  T1, 
       dir_Seances T2 
WHERE  (T2.keyFilm = T1.idMovie) 
GROUP BY 
       T1.idMovie, 
       T1.displayName, 
       T1.length, 
       T1.picture, 
       T1.lastDate 
HAVING (T1.lastDate &lt; MAX(T2.progDate))
</code></pre>
<p>Malheureusement, Access n'a pas du tout apprécié et m'a gratifié du message
d'erreur suivant : <em>Impossible d'obtenir des champs Memo, OLE ou
Hyperlink Object dans l'argument d'agrégat (T1.description)</em>.</p>
<p>Heureusement, Google a été plus conciliant et après <a href="http://allenbrowne.com/bug-18.html">quelques
recherches</a> j'ai fini par trouver qu'il suffisait d'utiliser la fonction
FIRST() ou LAST() pour contourner le problème.</p>
<pre><code>SELECT T1.idMovie, 
       T1.displayName, 
       T1.length, 
       T1.picture, 
       T1.lastDate, 
       LAST(T1.description) AS description, 
       MAX(T2.progDate) AS progDate 
FROM   dir_Movies  T1, 
       dir_Seances T2 
WHERE  (T2.keyFilm = T1.idMovie) 
GROUP BY 
       T1.idMovie, 
       T1.displayName, 
       T1.length, 
       T1.picture, 
       T1.lastDate 
HAVING (T1.lastDate &lt; MAX(T2.progDate))
</code></pre>
<p>Et ça marche : la requête passe et la colonne description n'est pas
tronquée à 255 caractères.</p>


  </div>

</article><nav class="paginate">
  <a rel="prev" href="/2008/12/11/renommer-namespaces-qc-ap/" hreflang="fr-FR">Renommer les namespaces de QC en AP</a>
  <a rel="next" href="/2008/12/18/sauvegarde-depot-subversion/" hreflang="fr-FR">Sauvegarder un dépôt Subversion</a>
</nav>



<div class="pub"><ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5475403929650645"
     data-ad-slot="8049019520"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins></div>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>


    <footer>
      <a href="/">blog.pagesd.info</a> //
      <a href="https://www.solitaire-play.com/">www.solitaire-play.com</a>
    </footer>

  </div>
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5475403929650645"
     crossorigin="anonymous"></script>
  </body>

</html>

<!doctype html>
<html lang="fr-FR">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Vérifier que les identifiants automatiques sont à jour - blog.pagesd.info</title>
    <link rel="shortcut icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" href="/atom.xml" title="blog.pagesd.info" type="application/atom+xml">
    <meta name="author" content="Michel" />
<link rel="canonical" href="https://blog.pagesd.info/2008/06/05/verifier-identifiants-automatiques-jour/" />
<meta property="og:title" content="Vérifier que les identifiants automatiques sont à jour" />
<meta property="og:locale" content="fr-FR" />
<meta property="og:url" content="https://blog.pagesd.info/2008/06/05/verifier-identifiants-automatiques-jour/" />
<meta property="og:site_name" content="blog.pagesd.info" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-06-05T13:32:00.000Z" />
<script type="application/ld+json">{"headline":"blog.pagesd.info","dateModified":"2008-06-05T13:32:00.000Z","datePublished":"2008-06-05T13:32:00.000Z","inLanguage":"fr-FR","url":"https://blog.pagesd.info/2008/06/05/verifier-identifiants-automatiques-jour/","@type":"BlogPosting","image":"","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.pagesd.info/2008/06/05/verifier-identifiants-automatiques-jour/"},"author":{"@type":"Person","name":"Michel"},"@context":"https://schema.org"}</script>
  </head>

  <body><div class="container">

    <header><nav>
      <a class="title" href="/">blog.pagesd.info</a>
      // <a href="/archives/">archives</a>
      // <a href="/traductions/">traductions</a>
    </nav></header>



<article>



  <header>
    <h1>
      <a href="/2008/06/05/verifier-identifiants-automatiques-jour/">Vérifier que les identifiants automatiques sont à jour</a>
    </h1>
    <p>
      <span>2008-06-05</span>
      <span>#boulot</span>
    </p>
  </header>

  <div>

<p>L'objectif est de s'assurer que pour toutes les tables qui ont un
identifiant automatique, cet identifiant ne soit pas supérieur à la valeur de
la séquence utilisée pour générer cet identifiant. (Pourquoi on se retrouve
dans cette situation, c'est un autre problème).</p>
<p>Conventions :</p>
<ul>
<li>tous les noms de tables sont préfixés par LUX_</li>
<li>tous les noms de clés primaires sont préfixés par PK_</li>
<li>tous les noms de séquences sont préfixés par SEQ_LUX_</li>
</ul>
<h2>Générer un script renvoyant la valeur maximum des identifiants de chaque</h2>
<p>table</p>
<h3>Requête pour générer les SELECT MAX() de chaque table</h3>
<pre><code>SELECT 'UNION SELECT ''' || TABLE_NAME || ''' AS TB_NAME, '
       || 'MAX(' || COLUMN_NAME || ') AS TB_IDMAX '
       || 'FROM ' || TABLE_NAME
FROM   USER_IND_COLUMNS
WHERE  TABLE_NAME LIKE 'LUX_%'
AND    INDEX_NAME LIKE 'PK_%'
AND    COLUMN_NAME IN (SELECT COLUMN_NAME FROM COLS WHERE DATA_TYPE = 'NUMBER')
ORDER BY TABLE_NAME
</code></pre>
<h3>Compléter le script généré</h3>
<p>Sous TOAD, faire clic droit dans le résultat de la requête et choisir SaveAs
et enregistrer dans le presse-papiers, ce qui donne :</p>
<pre><code>UNION SELECT 'LUX_BANQUES' AS TB_NAME, MAX(IDBANQUE) AS TB_IDMAX FROM LUX_BANQUES
UNION SELECT 'LUX_CLIENTS' AS TB_NAME, MAX(IDCLIENT) AS TB_IDMAX FROM LUX_CLIENTS
UNION SELECT 'LUX_COMPTES' AS TB_NAME, MAX(IDCOMPTE) AS TB_IDMAX FROM LUX_COMPTES
UNION SELECT 'LUX_CONTACTS' AS TB_NAME, MAX(IDCONTACT) AS TB_IDMAX FROM LUX_CONTACTS
...
</code></pre>
<p>Dans Notepad, enlever le premier UNION et préfixer par un CREATE TABLE</p>
<pre><code>CREATE TABLE TMP_IDMAXIMUMS AS
SELECT 'LUX_BANQUES' AS TB_NAME, MAX(IDBANQUE) AS TB_IDMAX FROM LUX_BANQUES
UNION SELECT 'LUX_CLIENTS' AS TB_NAME, MAX(IDCLIENT) AS TB_IDMAX FROM LUX_CLIENTS
UNION SELECT 'LUX_COMPTES' AS TB_NAME, MAX(IDCOMPTE) AS TB_IDMAX FROM LUX_COMPTES
UNION SELECT 'LUX_CONTACTS' AS TB_NAME, MAX(IDCONTACT) AS TB_IDMAX FROM LUX_CONTACTS
...
</code></pre>
<p>Puis exécuter ce script pour obtenir une première table TMP_IDMAXIMUMS qui
enregistrera la valeur maximum de l'identifiant de chaque table</p>
<h2>Créer une seconde table pour enregistrer la valeur maximum de chaque</h2>
<p>séquence</p>
<pre><code>CREATE TABLE TMP_SEQMAXIMUMS AS
SELECT SUBSTR(SEQUENCE_NAME, 5) AS TB_NAME, LAST_NUMBER AS TB_SEQMAX
FROM   USER_SEQUENCES
WHERE  SEQUENCE_NAME LIKE 'SEQ_LUX_%'
</code></pre>
<h2>Comparer le contenu des deux tables</h2>
<pre><code>SELECT T1.TB_NAME, TB_IDMAX, TB_SEQMAX
FROM   TMP_IDMAXIMUMS  T1,
       TMP_SEQMAXIMUMS T2
WHERE  T1.TB_NAME = T2.TB_NAME
AND    TB_IDMAX &gt; TB_SEQMAX
</code></pre>


  </div>

</article><nav class="paginate">
  <a rel="prev" href="/2008/01/07/evolutions-qc-7-janvier-2008/" hreflang="fr-FR">Evolutions QC au 7 janvier 2008</a>
  <a rel="next" href="/2008/07/15/creer-fichier-excel-net/" hreflang="fr-FR">Créer un fichier Excel en .NET</a>
</nav>



<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<div class="pub"><ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5475403929650645"
     data-ad-slot="8049019520"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins></div>
<script>window.onload = function() { (adsbygoogle = window.adsbygoogle || []).push({}); }</script>

    <footer>
      <a href="/">blog.pagesd.info</a> //
      <a href="https://www.solitaire-play.com/">www.solitaire-play.com</a>
    </footer>

  </div></body>

</html>
